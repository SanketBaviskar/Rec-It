import{i as S,r as C,v as P,u as B,j as e,F as V,a as c,b as o,c as i,d as l,I as m,A as D,E as d,G as L,B as g,Q as O,H as Q,J as R,K as U,M as G,N as H}from"./index-bC756Pjy.js";import{o as M,s as y,n as F,t as Y}from"./index-LAbyUkC8.js";import{d as J}from"./deleteEquipment-CIWO1BG8.js";const K=async j=>{try{return(await S.post("/equipments",j)).data}catch(u){throw console.error("Error creating equipment:",u),u}},$=async(j,u)=>{try{return(await S.put(`/equipments/${j}`,u)).data}catch(f){throw console.error("Error updating equipment:",f),f}},z=M({equipmentName:y().min(2,{message:"Equipment name must be at least 2 characters."}),equipmentCode:y().min(1,{message:"Equipment code is required."}),equipmentImage:y().optional(),description:y().min(10,{message:"Description must be at least 10 characters."}),quantity:F().min(1,{message:"Quantity must be at least 1."}),price:F().min(0,{message:"Price must be a positive value."}),replacementFees:F().min(0,{message:"Replacement fees must be a positive value."}),department:y(),location:y().min(2,{message:"Location must be at least 2 characters."})});function _({onComplete:j,categoryId:u,categoryName:f,mode:h,equipment:t,equipmentId:I}){const[E,b]=C.useState(!1),[w,v]=C.useState(!1),{toast:x}=P(),r=B({resolver:Y(z),defaultValues:{equipmentName:"",equipmentCode:"",equipmentImage:"",description:"",quantity:1,price:0,replacementFees:0,department:"",location:""}});C.useEffect(()=>{h==="edit"&&(r.reset({equipmentName:(t==null?void 0:t.name)||"",equipmentCode:(t==null?void 0:t.code)||"",equipmentImage:(t==null?void 0:t.image)||"",description:(t==null?void 0:t.description)||"",quantity:(t==null?void 0:t.quantity)||1,price:(t==null?void 0:t.price)||0,replacementFees:(t==null?void 0:t.replacementFees)||0,department:(t==null?void 0:t.inventory.name)||"",location:(t==null?void 0:t.location)||""}),console.log("Form Values",r.getValues()))},[h,t,r]);async function q(s){var a,p;try{(await $(I,{formVal:s})).status==="success"&&x({title:"Success",description:"Equipment Updated successfully",variant:"success"})}catch(n){x({title:"Error",description:((p=(a=n.response)==null?void 0:a.data)==null?void 0:p.message)||"Failed to add or update equipment",variant:"destructive"})}finally{b(!1)}}async function T(s){var a,p;b(!0);try{const n={name:s.equipmentName,code:s.equipmentCode,image:s.equipmentImage,description:s.description,quantity:s.quantity,price:s.price,replacementFees:s.replacementFees,location:s.location,inventoryId:parseInt(u||"",10)};(await K(n)).status==="success"&&(x({title:"Success",description:"Equipment added successfully",variant:"success"}),r.reset())}catch(n){x({title:"Error",description:((p=(a=n.response)==null?void 0:a.data)==null?void 0:p.message)||"Failed to add or update equipment",variant:"destructive"})}finally{b(!1)}}const k=()=>{r.reset(),v(!1),x({title:"Form Cancelled",description:"You have cancelled the form."}),j()};async function A(s){var p,n;const a=await J(s);try{a.status==="success"&&(x({title:"Success",description:"Equipment Deleted successfully",variant:"destructive"}),j())}catch(N){x({title:"Error",description:((n=(p=N.response)==null?void 0:p.data)==null?void 0:n.message)||"Failed to add or update equipment",variant:"destructive"})}finally{console.log("success")}}return e.jsxs(V,{...r,children:[e.jsxs("form",{onSubmit:r.handleSubmit(T),className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx(c,{control:r.control,name:"equipmentName",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Equipment Name"}),e.jsx(l,{children:e.jsx(m,{placeholder:"Enter equipment name",...s})}),e.jsx(D,{children:"Name of the equipment within the category."}),e.jsx(d,{})]})}),e.jsx(c,{control:r.control,name:"equipmentCode",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Equipment Code"}),e.jsx(l,{children:e.jsx(m,{placeholder:"Enter equipment code",...s})}),e.jsx(d,{})]})}),e.jsx(c,{control:r.control,name:"equipmentImage",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Equipment Image"}),e.jsx(l,{children:e.jsx(m,{id:"picture",type:"file",placeholder:"Upload equipment image",...s})}),e.jsx(d,{})]})}),e.jsx(c,{control:r.control,name:"quantity",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Quantity"}),e.jsx(l,{children:e.jsx(m,{type:"number",placeholder:"Enter quantity",...s,onChange:a=>s.onChange(parseInt(a.target.value)),min:1})}),e.jsx(d,{})]})}),e.jsx(c,{control:r.control,name:"price",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Price"}),e.jsx(l,{children:e.jsx(m,{type:"number",placeholder:"Enter price",...s,onChange:a=>s.onChange(parseFloat(a.target.value)),min:0,step:"0.01"})}),e.jsx(d,{})]})}),e.jsx(c,{control:r.control,name:"replacementFees",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Replacement Fees"}),e.jsx(l,{children:e.jsx(m,{type:"number",placeholder:"Enter replacement fees",...s,onChange:a=>s.onChange(parseFloat(a.target.value)),min:0,step:"0.01"})}),e.jsx(d,{})]})}),e.jsx(c,{control:r.control,name:"description",render:({field:s})=>e.jsxs(o,{className:"col-span-1 md:col-span-2 lg:col-span-3",children:[e.jsx(i,{children:"Description"}),e.jsx(l,{children:e.jsx(L,{placeholder:"Describe the equipment",...s})}),e.jsx(D,{children:"Provide a brief description of the equipment."}),e.jsx(d,{})]})}),e.jsx(c,{control:r.control,name:"department",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Department"}),e.jsx(l,{children:e.jsx(m,{value:h==="create"?f:s.value,disabled:!0})}),e.jsx(d,{})]})}),e.jsx(c,{control:r.control,name:"location",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Location"}),e.jsx(l,{children:e.jsx(m,{placeholder:"Enter location",...s})}),e.jsx(d,{})]})})]}),e.jsxs("div",{className:"flex space-x-4",children:[h==="create"&&e.jsx(g,{type:"submit",disabled:E,children:E?"Adding...":"Add Equipment"}),h==="edit"&&e.jsx(g,{type:"button",disabled:E,onClick:()=>q(r.getValues()),children:E?"Saving...":"Save Equipment"}),h==="create"&&e.jsx(g,{type:"button",variant:"destructive",onClick:()=>v(!0),children:"Cancel"}),h==="edit"&&e.jsx(g,{type:"button",variant:"destructive",onClick:()=>A(I),children:"Delete Equipment"})]})]}),e.jsx(O,{}),e.jsx(Q,{open:w,onOpenChange:v,children:e.jsxs(R,{children:[e.jsxs(U,{children:[e.jsx(G,{children:"Confirm Cancellation"}),e.jsx("p",{children:"Are you sure you want to cancel this form? Unsaved changes will be lost."})]}),e.jsxs(H,{children:[e.jsx(g,{variant:"ghost",onClick:()=>v(!1),children:"No, Go Back"}),e.jsx(g,{variant:"destructive",onClick:k,children:"Yes, Cancel"})]})]})})]})}export{_ as default};
